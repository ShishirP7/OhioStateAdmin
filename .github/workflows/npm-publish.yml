name: 🚀 Deploy Frontend to Contabo VPS

on:
  push:
    branches:
      - main

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest

    steps:
      - name: 🔐 SSH & Deploy Frontend
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }}
          port: 22
          script: |
            FRONTEND_DIR="/var/www/ohio-state-admin"
            FRONTEND_REPO_URL="https://github.com/ShishirP7/OhioStateAdmin.git"
            NGINX_DIR="/etc/nginx/sites-enabled"
            
            echo "🚀 Starting frontend deployment..."
            
            # Clone or pull the latest code
            echo "📁 Checking if frontend folder exists..."
            if [ -d "$FRONTEND_DIR" ]; then
              echo "🔄 Frontend exists. Pulling latest code..."
              cd $FRONTEND_DIR
              git pull origin main
            else
              echo "📦 Cloning frontend project..."
              git clone $FRONTEND_REPO_URL $FRONTEND_DIR
              cd $FRONTEND_DIR
            fi

            # Install dependencies and build
            echo "📦 Installing frontend dependencies..."
            npm install
            echo "🏗 Building frontend..."
            npm run build
            
            # Enable the site if not already enabled
            if [ ! -f "/etc/nginx/sites-enabled/ohio-state-admin" ]; then
              sudo ln -s /etc/nginx/sites-available/ohio-state-admin /etc/nginx/sites-enabled/
            fi
            
            sudo nginx -t
            sudo systemctl restart nginx
            
            echo "✅ Frontend deployment completed!"